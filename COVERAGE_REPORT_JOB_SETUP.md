# è¦†ç›–çŽ‡æŠ¥å‘Šç”Ÿæˆ Job é…ç½®æŒ‡å—

## ðŸ“‹ åœ¨ Jenkins ä¸­åˆ›å»ºæ–° Job

### æ­¥éª¤ 1: åˆ›å»º Pipeline Job

1. ç™»å½• Jenkins
2. ç‚¹å‡» **"æ–°å»ºä»»åŠ¡"** (New Item)
3. è¾“å…¥ä»»åŠ¡åç§°: `h5-coverage-report`
4. é€‰æ‹© **"æµæ°´çº¿"** (Pipeline)
5. ç‚¹å‡» **"ç¡®å®š"**

### æ­¥éª¤ 2: é…ç½® Pipeline

åœ¨ä»»åŠ¡é…ç½®é¡µé¢ï¼š

#### General éƒ¨åˆ†
- âœ… å‹¾é€‰ **"å‚æ•°åŒ–æž„å»º"** (This project is parameterized)
- å‚æ•°å·²åœ¨ Jenkinsfile.report ä¸­å®šä¹‰ï¼Œæ— éœ€æ‰‹åŠ¨æ·»åŠ 

#### Pipeline éƒ¨åˆ†
1. **å®šä¹‰**: é€‰æ‹© **"Pipeline script from SCM"**
2. **SCM**: é€‰æ‹© **"Git"**
3. **Repository URL**: `file:///var/jenkins_home/repositories/h5-coverage-demo`
4. **Credentials**: `- none -`
5. **Branch**: `*/main`
6. **è„šæœ¬è·¯å¾„**: `Jenkinsfile.report`

### æ­¥éª¤ 3: ä¿å­˜é…ç½®

ç‚¹å‡» **"ä¿å­˜"** (Save)

---

## ðŸš€ ä½¿ç”¨æµç¨‹

### å®Œæ•´å·¥ä½œæµ

```
1ï¸âƒ£ æž„å»ºåº”ç”¨
   è¿è¡Œ h5-coverage-demo Job (ENABLE_COVERAGE=true)
   â†“
   
2ï¸âƒ£ è¿è¡Œåº”ç”¨å¹¶æ”¶é›†æ•°æ®
   è®¿é—®: http://ä½ çš„æœåŠ¡å™¨IP:8888/
   æ“ä½œåº”ç”¨ï¼Œè§¦å‘ä»£ç æ‰§è¡Œ
   ç­‰å¾… 5-10 åˆ†é’Ÿï¼ˆæˆ–æ›´é•¿æ—¶é—´ï¼‰
   â†“
   
3ï¸âƒ£ ç”ŸæˆæŠ¥å‘Š
   è¿è¡Œ h5-coverage-report Job
   â†“
   
4ï¸âƒ£ æŸ¥çœ‹æŠ¥å‘Š
   åœ¨ Jenkins æž„å»ºé¡µé¢æŸ¥çœ‹ "Coverage Report" æˆ–ä¸‹è½½äº§ç‰©
```

---

## ðŸ“Š æŸ¥çœ‹æŠ¥å‘Šçš„ä¸¤ç§æ–¹å¼

### æ–¹å¼ 1: HTML Publisherï¼ˆæŽ¨èï¼‰

**å‰ææ¡ä»¶**: éœ€è¦å®‰è£… HTML Publisher æ’ä»¶

#### å®‰è£…æ’ä»¶
1. Jenkins â†’ **ç³»ç»Ÿç®¡ç†** â†’ **æ’ä»¶ç®¡ç†**
2. æœç´¢ **"HTML Publisher"**
3. å®‰è£…å¹¶é‡å¯

#### æŸ¥çœ‹æŠ¥å‘Š
1. è¿›å…¥ `h5-coverage-report` æž„å»ºé¡µé¢
2. å·¦ä¾§èœå•ç‚¹å‡» **"Coverage Report"**
3. æµè§ˆå™¨æ‰“å¼€è¯¦ç»†çš„ HTML æŠ¥å‘Š

### æ–¹å¼ 2: ä¸‹è½½æž„å»ºäº§ç‰©

**æ— éœ€é¢å¤–æ’ä»¶**

#### æŸ¥çœ‹æŠ¥å‘Š
1. è¿›å…¥ `h5-coverage-report` æž„å»ºé¡µé¢
2. ç‚¹å‡» **"Build Artifacts"**
3. ä¸‹è½½ `coverage` ç›®å½•
4. åœ¨æœ¬åœ°æ‰“å¼€ `coverage/index.html`

---

## ðŸ”§ æ•…éšœæŽ’æŸ¥

### é—®é¢˜ 1: "è¦†ç›–çŽ‡æ•°æ®æ–‡ä»¶ä¸å­˜åœ¨"

**åŽŸå› **: åº”ç”¨æœªè¿è¡Œæˆ–æœªæ”¶é›†æ•°æ®

**è§£å†³**:
```bash
# æ£€æŸ¥æ•°æ®æ–‡ä»¶æ˜¯å¦å­˜åœ¨
docker exec -it b1b2c451c54c ls -la /var/jenkins_home/workspace/h5-coverage-demo/.nyc_output/coverage.json

# æ£€æŸ¥è¦†ç›–çŽ‡æœåŠ¡å™¨æ˜¯å¦è¿è¡Œ
ps aux | grep coverage-server

# é‡æ–°å¯åŠ¨è¦†ç›–çŽ‡æœåŠ¡å™¨
cd /tmp/h5-demo
nohup node coverage-server.js > server.log 2>&1 &
```

### é—®é¢˜ 2: "HTML Publisher æ’ä»¶æœªå®‰è£…"

**è§£å†³**:
- å®‰è£…æ’ä»¶ï¼ˆè§ä¸Šé¢çš„å®‰è£…æ­¥éª¤ï¼‰
- æˆ–ä½¿ç”¨æ–¹å¼ 2 ä¸‹è½½äº§ç‰©æŸ¥çœ‹

### é—®é¢˜ 3: æŠ¥å‘Šæ•°æ®ä¸ºç©º

**åŽŸå› **: 
1. è¦†ç›–çŽ‡æ•°æ®æœªæ­£ç¡®æ”¶é›†
2. coverage-config.js é…ç½®é”™è¯¯

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹è¦†ç›–çŽ‡æ•°æ®å†…å®¹
docker exec -it b1b2c451c54c cat /var/jenkins_home/workspace/h5-coverage-demo/.nyc_output/coverage.json | head -50

# åº”è¯¥çœ‹åˆ°ç±»ä¼¼:
# {"/var/jenkins_home/workspace/h5-coverage-demo/src/index.js": {...}}
```

---

## ðŸ’¡ ä½¿ç”¨æŠ€å·§

### æŠ€å·§ 1: å®šæœŸç”ŸæˆæŠ¥å‘Š

å¯ä»¥é…ç½®å®šæ—¶æž„å»ºï¼Œæ¯å¤©è‡ªåŠ¨ç”ŸæˆæŠ¥å‘Šï¼š

1. è¿›å…¥ Job é…ç½®
2. å‹¾é€‰ **"Build periodically"**
3. Schedule: `0 2 * * *` (æ¯å¤©å‡Œæ™¨ 2 ç‚¹)

### æŠ€å·§ 2: å¯¹æ¯”ä¸åŒæ—¶é—´çš„è¦†ç›–çŽ‡

Jenkins ä¼šä¿ç•™åŽ†å²æž„å»ºçš„æŠ¥å‘Šï¼Œå¯ä»¥å¯¹æ¯”ï¼š
1. æŸ¥çœ‹ä¸åŒæž„å»ºå·çš„æŠ¥å‘Š
2. è§‚å¯Ÿè¦†ç›–çŽ‡è¶‹åŠ¿

### æŠ€å·§ 3: æ‰‹åŠ¨è§¦å‘ç”Ÿæˆ

ä¸éœ€è¦ç­‰å¾…æž„å»ºé˜Ÿåˆ—ï¼Œéšæ—¶å¯ä»¥ç‚¹å‡» **"Build with Parameters"** æ‰‹åŠ¨è§¦å‘ã€‚

---

## ðŸ“ å‚æ•°è¯´æ˜Ž

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜Ž |
|------|--------|------|
| `PROJECT_NAME` | `h5-coverage-demo` | é¡¹ç›®åç§° |
| `WORKSPACE_PATH` | `/var/jenkins_home/workspace/h5-coverage-demo` | å·¥ä½œç©ºé—´è·¯å¾„ |

é€šå¸¸ä½¿ç”¨é»˜è®¤å€¼å³å¯ã€‚å¦‚æžœæœ‰å¤šä¸ªé¡¹ç›®æˆ–ä¸åŒçš„å·¥ä½œç©ºé—´ï¼Œå¯ä»¥ä¿®æ”¹å‚æ•°ã€‚

---

## âœ… éªŒè¯æ¸…å•

æž„å»ºæˆåŠŸåŽï¼Œç¡®è®¤ä»¥ä¸‹å†…å®¹ï¼š

- [ ] æž„å»ºæ—¥å¿—æ˜¾ç¤º "âœ“ è¦†ç›–çŽ‡æ•°æ®æ–‡ä»¶å­˜åœ¨"
- [ ] æž„å»ºæ—¥å¿—æ˜¾ç¤ºæ–‡ä»¶æ•°ç»Ÿè®¡ï¼ˆåº”è¯¥ â‰¥ 1ï¼‰
- [ ] æž„å»ºæ—¥å¿—æ˜¾ç¤º "âœ“ è¦†ç›–çŽ‡æŠ¥å‘Šå·²ç”Ÿæˆ"
- [ ] èƒ½å¤ŸæŸ¥çœ‹æˆ–ä¸‹è½½æŠ¥å‘Š
- [ ] æŠ¥å‘Šä¸­æ˜¾ç¤ºæ­£ç¡®çš„è¦†ç›–çŽ‡ç™¾åˆ†æ¯”ï¼ˆ> 0%ï¼‰
